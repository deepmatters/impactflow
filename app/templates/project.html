{% extends "base.html" %}

{% block content %}
<div class="main-wrapper">
    <p><a href="/">< กลับไปหน้าหลัก Back to Home</a></p>
    <div class="spacer-big"></div>
    {% if imgs %}
        <img class="org-logo" src="{{ imgs[0] }}" alt="{{ project.title }} logo">
    {% else %}
        <img class="org-logo placeholder" src="/static/impactflow-logo.png" alt="Placeholder image">
    {% endif %}
    <div class="main-flex-wrapper">
        <div class="main-flex-left">
            <h1>{{ project['json']['title'] }}</h1>
            {% if project['json']['published'] %}
                <span class="shared">เผยแพร่ Shared</span> 
                <span class="url">https://impactflow.org/project/{{ project.id }}</span>
            {% else %}
                <span class="private">ไม่เผยแพร่ Private</span>
            {% endif %}
            {% if project.mod_dt %}
                <p class="gray-small">Created: {{ project.create_dt|datetimefilter }} | Last edit: {{ project.mod_dt|datetimefilter }}</p>
            {% else %}
                <p class="gray-small">Created: {{ project.create_dt|datetimefilter }}</p>
            {% endif %}
            <h2>เป้าหมาย Impact Goals</h2>
            {% for k in sdg_dict_sel.keys() %}
                <img class="sdg-icons" src="{{ sdg_dict_sel.get(k) }}" alt="SDG {{ k }}">
            {% endfor %}
            
            {% for impact in project['json']['impact'] %}
                <p>{{ impact['sdg'] }}</p>
                <ul>
                    {% for target in impact['target'] %}
                        <li>{{ target }}</li>
                    {% endfor %}
                </ul>
            {% endfor %}
            <h2>ภาพรวม Summary</h2>
            <p>{{ project['json']['summary'] }}</p>
            <p>ระยะเวลา Duration: {{ project['json']['duration'] }} เดือน Month</p>
            <p>งบประมาณ Budget: {{ "{:,.2f}".format(project['json']['budget']) }} บาท Baht</p>
            <p>ผู้รับผิดชอบ Team</p>
            <ul>
                {% for team in project['json']['team'] %}
                    <li>{{ team['teamName'] }} ({{ team['teamPosition'] }})</li>
                {% endfor %}
            </ul>
            <br>
            {% if editable %}
                <div class="passed-zone">
                    <div class="spacer-small"></div>
                    <a class="no-decoration" href="/project/{{ project.id }}/edit"><button class="button-edit">แก้ไขข้อมูลโครงการนี้<br>Edit project's info</button></a>&nbsp;&nbsp;
                    <a class="no-decoration" href="/project/{{ project.id }}/upload"><button class="button-edit">อับโหลดภาพโลโก้<br>Upload a logo</button></a>&nbsp;&nbsp;
                    <span class="caution"><a href="/project/{{ project.id }}/delete">ลบโครงการนี้ Delete this project</a></span>
                </div>
                <br>
            {% endif %}
        </div>
    </div>
    
    <h2>โมเดลผลกระทบทางสังคม Impact Model</h2>
    {% if not stakeholders %}
        {% if editable %}
            <p>เริ่มสร้าง Impact model โดยการเพิ่มผู้มีส่วนได้เสีย Start creating an impact model by adding a stakeholder.</p>
            <a class="no-decoration" href="/project/{{ project.id }}/stakeholder-create"><button class="button">เพิ่มผู้มีส่วนได้เสีย<br>Add a stakeholder</button></a>
        {% endif %}
    {% else %}
        <table>
            <tr>
                <th class="activity">กิจกรรม Activities</th>
                <th class="activity">ผลผลิต Outputs</th>
                <th class="activity">ผลลัพธ์ Outcomes</th>
            </tr>
        {% for stakeholder in stakeholders %}
            <tr>
                <td class="stakeholder" colspan="3">
                    <div class="stakeholder-wrapper">
                        <a class="no-decoration" href="/project/{{ project.id }}/{{ stakeholder.id }}"><h1>{{ stakeholder['json']['stakeholder'] }}</h1></a>
                        <p class="gray-small">{{ stakeholder['json']['degree'] }} | ความสำคัญ Importance: {{ stakeholder['json']['importance'] }}</p>
                        <p>{{ stakeholder['json']['description'] }}</p>
                        {% if editable %}
                            [ <a class="gray-small" href="/project/{{ project.id }}/{{ stakeholder.id }}/edit">แก้ไข Edit</a> ] [ <a class="gray-small" href="/project/{{ project.id }}/{{ stakeholder.id }}/delete">ลบ Delete</a> ]
                        {% endif %}
                    </div>
                </td>
            </tr>
            <tr>
                <td class="activity">
                    {% for activity in activities %}
                        {% if activity[0] == stakeholder.id %}
                            <div class="activity-wrapper">
                                <p class="impact-type" style="background-color: {{ activity[1]['json']['bgcolor'] }};">กิจกรรม Activity ({{ stakeholder['json']['stakeholder'] }})</p>
                                <a class="no-decoration" href="/project/{{ project.id }}/{{ stakeholder.id }}/{{ activity[1].id }}"><h3>{{ activity[1]['json']['activity'] }}</h3></a>
                                {% if editable %}
                                    [ <a class="gray-small" href="/project/{{ project.id }}/{{ stakeholder.id }}/{{ activity[1].id }}/edit">แก้ไข Edit</a> ] [ <a class="gray-small" href="/project/{{ project.id }}/{{ stakeholder.id }}/{{ activity[1].id }}/delete">ลบ Delete</a> ]
                                {% endif %}
                                <div class="spacer-big"></div>            
                            </div>
                        {% endif %}
                    {% endfor %}
                    {% if editable %}
                        <a class="no-decoration" href="/project/{{ project.id }}/{{ stakeholder.id }}/activity-create"><button class="add-model">+ เพิ่มกิจกรรม Add an activity ({{ stakeholder['json']['stakeholder'] }})</button></a>
                    {% endif %}
                </td>
                <td class="activity">
                    {% for activity in activities %}
                        {% if activity[0] == stakeholder.id %}
                            {% for output in outputs %}
                                {% if output[0] == activity[1].id %}
                                    <div class="activity-wrapper">
                                        <p class="impact-type" style="background-color: {{ activity[1]['json']['bgcolor'] }};">ผลผลิต Output ({{ activity[1]['json']['activity'] }})</p>
                                        <a class="no-decoration" href="/project/{{ project.id }}/{{ stakeholder.id }}/{{ activity[1].id }}/{{ output[1].id }}"><h3>{{ output[1]['json']['output'] }}</h3></a>
                                        <!-- <p>{{ output[1]['json']['indicatorCategory'] }}</p> -->
                                        <p>{{ output[1]['json']['indicator'] }}</p>
                                        <p>จำนวนเริ่ม Baseline Amount: {{ output[1]['json']['indicatorBaseline'] }} {{ output[1]['json']['indicatorUnit'] }}<br>
                                        จำนวนเป้าหมาย Target Amount: {{ output[1]['json']['indicatorTarget'] }} {{ output[1]['json']['indicatorUnit'] }}</p>
                                        {% if editable %}
                                            [ <a class="gray-small" href="/project/{{ project.id }}/{{ stakeholder.id }}/{{ activity[1].id }}/{{ output[1].id }}/edit">แก้ไข Edit</a> ] [ <a class="gray-small" href="/project/{{ project.id }}/{{ stakeholder.id }}/{{ activity[1].id }}/{{ output[1].id }}/delete">ลบ Delete</a> ]
                                        {% endif %}
                                        <div class="spacer-big"></div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                            {% if editable %}
                                <a class="no-decoration" href="/project/{{ project.id }}/{{ stakeholder.id }}/{{ activity[1].id }}/output-create"><button class="add-model" style="color: #4d4d4d; background-color: {{ activity[1]['json']['bgcolor'] }};">+ เพิ่มผลผลิต Add an output ({{ activity[1]['json']['activity'] }})</button></a>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    
                </td>
                <td class="activity">
                    {% for activity in activities %}
                        {% if activity[0] == stakeholder.id %}
                            {% for output in outputs %}
                                {% if output[0] == activity[1].id %}
                                    {% for outcome in outcomes %}
                                        {% if outcome[0] == output[1].id %}
                                            <div class="activity-wrapper">
                                                <p class="impact-type" style="background-color: {{ activity[1]['json']['bgcolor'] }};">ผลลัพธ์ Outcome ({{ output[1]['json']['output'] }})</p>
                                                <a class="no-decoration" href="/project/{{ project.id }}/{{ stakeholder.id }}/{{ activity[1].id }}/{{ output[1].id }}/{{ outcome[1].id }}"><h3>{{ outcome[1]['json']['outcome'] }}</h3></a>
                                                <p>{{ outcome[1]['json']['indicator'] }}</p>
                                                <p>จำนวนเริ่ม Baseline Amount: {{ outcome[1]['json']['indicatorBaseline'] }} {{ outcome[1]['json']['indicatorUnit'] }}<br>
                                                จำนวนเป้าหมาย Target Amount: {{ outcome[1]['json']['indicatorTarget'] }} {{ outcome[1]['json']['indicatorUnit'] }}</p>
                                                {% if editable %}
                                                    [ <a class="gray-small" href="/project/{{ project.id }}/{{ stakeholder.id }}/{{ activity[1].id }}/{{ output[1].id }}/{{ outcome[1].id }}/edit">แก้ไข Edit</a> ] [ <a class="gray-small" href="/project/{{ project.id }}/{{ stakeholder.id }}/{{ activity[1].id }}/{{ output[1].id }}/{{ outcome[1].id }}/delete">ลบ Delete</a> ]
                                                {% endif %}
                                                <div class="spacer-big"></div>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                    {% if editable %}
                                        <a class="no-decoration" href="/project/{{ project.id }}/{{ stakeholder.id }}/{{ activity[1].id }}/{{ output[1].id }}/outcome-create"><button class="add-model" style="color: #4d4d4d; background-color: {{ activity[1]['json']['bgcolor'] }};">+ เพิ่มผลลัพธ์ Add an outcome ({{ output[1]['json']['output'] }})</button></a>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                </td>
            </tr>
        {% endfor %}
        {% if editable %}
            <tr style="border-top: 1px solid #cccccc;">
                <td>
                    <a class="no-decoration" href="/project/{{ project.id }}/stakeholder-create"><button class="add-model">+ เพิ่มผู้มีส่วนได้เสีย Add a stakeholder</button></a>
                    <div class="spacer-small"></div>
                </td>
            </tr>
        {% endif %}
        </table>
        
    {% endif %}
</div>
{% endblock %}